<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#000000">
<title>5in1 RETRO SYSTEM</title>

<link rel="icon" href="icon.png" type="image/png">
<link rel="apple-touch-icon" href="icon.png">

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-user-select: none; -webkit-touch-callout: none; }
body { background: #000; display: flex; justify-content: center; align-items: center; min-height: 100vh; font-family: 'Courier New', Courier, monospace; overflow: hidden; touch-action: none; -webkit-tap-highlight-color: transparent; width: 100vw; height: 100vh; }

/* 2D„Ç≤„Éº„É†Ê©üÂÖ®‰Ωì„ÅÆ„Éô„Éº„Çπ */
#gameboy { width: 100%; max-width: 450px; height: 100%; max-height: 900px; background: linear-gradient(135deg, #d8d8d8 0%, #c0c0c0 100%); border-radius: 20px; display: flex; flex-direction: column; box-shadow: inset -5px -5px 15px rgba(0,0,0,0.3), 5px 5px 25px rgba(0,0,0,0.9); position: relative; opacity: 1; transition: opacity 0.3s; }
#screen-container { flex: 1; background: #444; margin: 15px 15px 5px 15px; border-radius: 10px 10px 40px 10px; display: flex; justify-content: center; align-items: center; padding: 10px; border: 3px solid #777; box-shadow: inset 3px 3px 12px rgba(0,0,0,0.6); position: relative; overflow: hidden; z-index: 5; }
#boot { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #0f0; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; transition: opacity 0.5s; border-radius: 6px 6px 35px 6px; pointer-events: none; }
#boot.hidden { opacity: 0; }
.boot-text { font-size: 10px; margin: 4px 0; }
.boot-bar { width: 80%; height: 15px; border: 2px solid #0f0; margin-top: 15px; }
.boot-fill { height: 100%; background: #0f0; width: 0%; transition: width 0.1s; }

/* ‚òÖ ‰øÆÊ≠£Ôºö2D„Ç≠„É£„É≥„Éê„ÇπÂ∞ÇÁî®„ÅÆÊåáÂÆö„Å´Â§âÊõ¥„Åó„ÄÅ3DÁîªÈù¢„ÅÆÈÇ™È≠î„Çí„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´„Åó„Åü */
#gameCanvas { background: #000; width: 100%; max-width: 320px; aspect-ratio: 1 / 1.5; image-rendering: pixelated; box-shadow: 0 0 15px rgba(0,0,0,0.9); z-index: 1; border-radius: 2px; touch-action: none; }
.mode-tall #gameCanvas { aspect-ratio: 1 / 2; width: auto; max-width: 100%; height: 100%; max-height: 100%; border-radius: 8px; box-shadow: 0 0 30px rgba(0, 255, 0, 0.2); }

#controls { height: 300px; position: relative; background: linear-gradient(135deg, #d8d8d8 0%, #c0c0c0 100%); border-radius: 0 0 20px 20px; overflow: hidden; z-index: 20; transition: height 1s; }
#classic-controls { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

.d-btn, .a-btn, .s-btn { touch-action: none; -webkit-tap-highlight-color: transparent; }
#dpad { position: absolute; left: 35px; top: 35px; width: 150px; height: 150px; }
.d-btn { position: absolute; background: #333; border-radius: 4px; box-shadow: inset -2px -2px 5px rgba(0,0,0,0.5); cursor: pointer; }
.d-btn:active { background: #111; transform: translateY(2px); }
#btn-up { top: 0; left: 50px; width: 50px; height: 50px; border-radius: 5px 5px 0 0; }
#btn-down { bottom: 0; left: 50px; width: 50px; height: 50px; border-radius: 0 0 5px 5px; }
#btn-left { top: 50px; left: 0; width: 50px; height: 50px; border-radius: 5px 0 0 5px; }
#btn-right { top: 50px; right: 0; width: 50px; height: 50px; border-radius: 0 5px 5px 0; }
.d-center { top: 50px; left: 50px; width: 50px; height: 50px; background: #333; position: absolute; }

#action-buttons { position: absolute; right: 25px; top: 55px; width: 160px; height: 120px; transform: rotate(-15deg); }
.a-btn { position: absolute; width: 70px; height: 70px; background: #b00; border-radius: 50%; color: #faa; font-weight: bold; font-size: 24px; text-align: center; line-height: 70px; box-shadow: inset -2px -2px 5px rgba(0,0,0,0.5), 3px 3px 6px rgba(0,0,0,0.4); cursor: pointer; }
.a-btn:active { background: #800; transform: translateY(2px); }
#btn-b { left: 0; bottom: 0; } #btn-a { right: 0; top: 0; }
.btn-label { position: absolute; font-size: 16px; color: #555; font-weight: bold; pointer-events: none; }
#label-b { left: 25px; bottom: -28px; } #label-a { right: 25px; top: -28px; }

#sys-buttons { position: absolute; bottom: 35px; width: 100%; display: flex; justify-content: center; }
.s-btn-wrap { text-align: center; }
.s-btn { width: 70px; height: 20px; background: #555; border-radius: 10px; box-shadow: inset -1px -1px 3px rgba(0,0,0,0.5); transform: rotate(-15deg); cursor: pointer; }
.s-btn:active { background: #333; }
.s-label { font-size: 12px; color: #555; font-weight: bold; margin-top: 8px; }
.mode-tall #controls { height: 0px !important; opacity: 0; margin: 0; padding: 0; } 

/* =========================================
   ‚òÖ 3D„Éû„Ç§„ÇØ„É©Áî® Ê®™ÁîªÈù¢„Éï„É´„Çπ„ÇØ„É™„Éº„É≥UI
   ========================================= */
/* ‚òÖ ‰øÆÊ≠£Ôºöposition: fixed „ÅßÁîªÈù¢ÂÖ®‰Ωì„Å´Á¢∫ÂÆü„Å´Âõ∫ÂÆö„Åô„Çã */
#mine-container { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1000; background: #000; overflow: hidden; }
#mine-container.active { display: block; }
#mine-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }

/* Á∏¶ÁîªÈù¢ÊôÇ„ÅÆË≠¶ÂëäË°®Á§∫ */
#rotate-warning { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); color: #fff; z-index: 2000; justify-content: center; align-items: center; flex-direction: column; text-align: center; font-size: 20px; font-weight: bold; font-family: sans-serif; pointer-events: auto; }
.icon-rotate { font-size: 50px; margin-bottom: 20px; display: block; transform: rotate(-90deg); }

/* „Ç≥„É≥„Éà„É≠„Éº„É©„Éº */
#joystick-zone { position: absolute; bottom: 40px; left: 40px; width: 160px; height: 160px; background: rgba(255,255,255,0.15); border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); pointer-events: auto; touch-action: none; }
#joystick-knob { position: absolute; top: 40px; left: 40px; width: 80px; height: 80px; background: rgba(255,255,255,0.7); border-radius: 50%; pointer-events: none; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
#touch-zone { position: absolute; top: 0; right: 0; width: 50%; height: 100%; pointer-events: auto; touch-action: none; }
.mine-btn { position: absolute; background: rgba(0,0,0,0.4); border: 2px solid rgba(255,255,255,0.5); color: #fff; text-align: center; font-weight: bold; pointer-events: auto; user-select: none; border-radius: 8px; font-family: sans-serif; }
.mine-btn:active { background: rgba(255,255,255,0.3); }
#btn-jump { bottom: 40px; right: 40px; width: 80px; height: 80px; line-height: 76px; font-size: 32px; border-radius: 50%; }
#btn-mine-exit { top: 20px; right: 20px; width: 50px; height: 50px; line-height: 46px; font-size: 20px; border-radius: 8px; }
#crosshair { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(255,255,255,0.8); font-size: 28px; pointer-events: none; text-shadow: 1px 1px 2px #000; font-family: sans-serif; }
</style>
</head>
<body>
<div id="gameboy">
  <div id="screen-container">
    <div id="boot">
      <div class="boot-text">5in1 RETRO SYSTEM</div>
      <div class="boot-text">SYSTEM BOOTING...</div>
      <div class="boot-bar"><div class="boot-fill" id="bootProgress"></div></div>
      <div class="boot-text" id="bootStatus" style="margin-top: 10px;">Loading...</div>
    </div>
    <canvas id="gameCanvas" width="200" height="300"></canvas>
  </div>
  
  <div id="controls">
    <div id="classic-controls">
      <div id="dpad">
        <div class="d-center"></div>
        <div class="d-btn" id="btn-up"></div>
        <div class="d-btn" id="btn-down"></div>
        <div class="d-btn" id="btn-left"></div>
        <div class="d-btn" id="btn-right"></div>
      </div>
      <div id="action-buttons">
        <div class="a-btn" id="btn-b">B</div>
        <div class="btn-label" id="label-b">B</div>
        <div class="a-btn" id="btn-a">A</div>
        <div class="btn-label" id="label-a">A</div>
      </div>
      <div id="sys-buttons">
        <div class="s-btn-wrap"><div class="s-btn" id="btn-select"></div><div class="s-label">SELECT</div></div>
      </div>
    </div>
  </div>
</div>

<div id="mine-container">
  <div id="rotate-warning">
    <span class="icon-rotate">üì±</span>
    „Çπ„Éû„Éõ„ÇíÊ®™Âêë„Åç„Å´<br>ÊåÅ„Å°Êõø„Åà„Å¶„Åè„Å†„Åï„ÅÑ<br><br>
    <span style="font-size:12px; font-weight:normal;">‚ÄªÁîªÈù¢„ÅÆÂõûËª¢„É≠„ÉÉ„ÇØ„ÇíËß£Èô§„Åó„Å¶„Åè„Å†„Åï„ÅÑ</span>
  </div>
  <div id="mine-ui">
    <div id="joystick-zone"><div id="joystick-knob"></div></div>
    <div id="touch-zone"></div>
    <div class="mine-btn" id="btn-jump">‚ñ≤</div>
    <div class="mine-btn" id="btn-mine-exit">II</div>
    <div id="crosshair">+</div>
  </div>
</div>

<script>
let bootProgress = 0;
const bootInterval = setInterval(() => {
  bootProgress += Math.random() * 15;
  if (bootProgress > 100) bootProgress = 100;
  document.getElementById('bootProgress').style.width = bootProgress + '%';
  document.getElementById('bootStatus').textContent = bootProgress < 90 ? 'Checking Memory...' : 'OK!';
  if (bootProgress >= 100) {
    clearInterval(bootInterval);
    setTimeout(() => { document.getElementById('boot').classList.add('hidden'); }, 500);
  }
}, 100);
</script>

<script src="main.js"></script>
<script src="guide.js"></script>
<script src="tetri.js"></script>
<script src="action.js"></script>
<script src="rpg.js"></script>
<script src="arena.js"></script>
<script src="online.js"></script>
<script src="rhythm.js"></script>
<script src="mine.js"></script>

<script>
window.onload = () => {
  activeApp = Menu;
  activeApp.init();
  requestAnimationFrame(loop);
};
</script>
</body>
</html>
